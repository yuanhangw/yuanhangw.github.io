
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Timing</title><meta name="generator" content="MATLAB 8.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2015-08-12"><meta name="DC.source" content="Timing.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1></h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">This program explore the calendar anormaly using benchmark data downloaded from bloomberg,</a></li><li><a href="#2">plot summer winter all in one</a></li><li><a href="#3">plot single index one by one</a></li></ul></div><h2>This program explore the calendar anormaly using benchmark data downloaded from bloomberg,<a name="1"></a></h2><p>We use the following seven data sets: 'Index','country','fx','gsci','gsfactors','ussectors'</p><pre class="codeinput">clear;
load <span class="string">benchmarks</span>;
load <span class="string">job_benchmark</span>;


<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">%%%%%%%%% transform into fts objects %%%%%%%%%%</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

list = {<span class="string">'Index'</span>,<span class="string">'country'</span>,<span class="string">'fx'</span>,<span class="string">'gsci'</span>,<span class="string">'gsfactors'</span>,<span class="string">'ussectors'</span>};

k=1;

px = cell(length(list),1);

period = 10000;
garch_calib_period = min(2000,period);


<span class="keyword">while</span> k &lt;= length(list)

    n=1;

    px_x = cell(size(eval(list{k}),1),1);

    <span class="keyword">while</span> n&lt;= size(eval(list{k}),1)

        px_x(n) = {fints(storage{k}{n}(end-period:end,1),storage{k}{n}(end-period:end,2),regexprep(eval(sprintf(<span class="string">'%s(n,1)'</span>,list{k})),<span class="string">'[^a-zA-Z_]'</span>,<span class="string">''</span>),<span class="string">'d'</span>,<span class="string">'LAST_PRICE'</span>)};

        n=n+1;

    <span class="keyword">end</span>

    px(k) = {merge(px_x{1:end},<span class="string">'SortColumns'</span>,0)};

    k = k +1;

<span class="keyword">end</span>

<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">%%%%%%%%%%%%%%% plot the result  %%%%%%%%%%%%%%</span>
<span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="comment">% k is list category: Index, fx etc...</span>
<span class="comment">% 1 'Index'</span>
<span class="comment">% 2 'country'</span>
<span class="comment">% 3 'fx'</span>
<span class="comment">% 4 'gsci'</span>
<span class="comment">% 5 'gsfactors'</span>
<span class="comment">% 6 'ussectors'</span>

<span class="comment">% SELECT k value before proceed.</span>

k=1;



    rt = tick2ret(px{k},<span class="string">'Method'</span>,<span class="string">'Continuous'</span>);
    rt = fillts(rt,0);
    rt_mx = fts2mat(rt,1);

    perf = rt_mx;
    perf(:,2:end) = cumsum(rt_mx(:,2:end));



    <span class="comment">% date filter</span>
    <span class="comment">% 0) april - oct effect</span>

    rt_month_effect_summer = rt_mx;

    condition_summer = month(rt_month_effect_summer(:,1))&gt;=11 | month(rt_month_effect_summer(:,1))&lt;=4;
    rt_month_effect_summer(condition_summer,2:end)=0;

    rt_month_effect_winter = rt_mx;
    condition_winter = month(rt_month_effect_winter(:,1))&lt;11 &amp; month(rt_month_effect_winter(:,1))&gt;4;
    rt_month_effect_winter(condition_winter,2:end)=0;

    perf_month_effect_summer = rt_month_effect_summer;
    perf_month_effect_summer(:,2:end) = cumsum(rt_month_effect_summer(:,2:end));

    perf_month_effect_winter = rt_month_effect_winter;
    perf_month_effect_winter(:,2:end) = cumsum(rt_month_effect_winter(:,2:end));
</pre><h2>plot summer winter all in one<a name="2"></a></h2><pre class="codeinput">        figure;
        subplot(3,1,1)
        plot(perf_month_effect_summer(:,2:end));
        subplot(3,1,2)
        plot(perf_month_effect_winter(:,2:end));
        subplot(3,1,3)
        plot(perf(:,2:end));
</pre><img vspace="5" hspace="5" src="Timing_01.png" alt=""> <h2>plot single index one by one<a name="3"></a></h2><pre class="codeinput">        figure;
        i = 1;
        <span class="keyword">while</span> i&lt;= size(eval(list{k}),1)

            subplot(5,3,i)
            plot(perf_month_effect_summer(:,i+1))
            hold <span class="string">on</span>
            plot(perf_month_effect_winter(:,i+1))
            plot(perf(:,i+1))
            hold <span class="string">off</span>
            title(Index(i))
            i = i+1;

        <span class="keyword">end</span>




    <span class="comment">% 1) first three and last three working date of month</span>

    rt_start_of_month = rt_mx;
    condition_busday = isbusday(rt_mx(:,1));
    condition_start_of_month = wrkdydif(fbusdate(year(rt_mx(:,1)),month(rt_mx(:,1))),rt_mx(:,1))&gt;3;

    rt_start_of_month(condition_busday &amp;  condition_start_of_month ,2:end) = 0;

    rt_end_of_month = rt_mx;
    condition_end_of_month = wrkdydif(rt_mx(:,1),fbusdate(year(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)),month(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1))))&gt;4;
    rt_end_of_month(condition_busday &amp;  condition_end_of_month ,2:end) = 0;

    rt_turn_of_month = rt_mx;
    rt_turn_of_month(condition_busday &amp; (condition_end_of_month &amp; condition_start_of_month),2:end)= 0;

    perf_start_of_month =rt_mx;
    perf_start_of_month(:,2:end) = cumsum(rt_start_of_month(:,2:end));

    perf_end_of_month =rt_mx;
    perf_end_of_month(:,2:end) = cumsum(rt_end_of_month(:,2:end));

    perf_turn_of_month = rt_mx;
    perf_turn_of_month(:,2:end) = cumsum(rt_turn_of_month(:,2:end));



    <span class="comment">% plot turn of month performance all in one</span>
        figure;
        subplot(4,1,1)
        plot(perf_start_of_month(:,2:end));
        subplot(4,1,2)
        plot(perf_end_of_month(:,2:end));
        subplot(4,1,3)
        plot(perf_turn_of_month(:,2:end));
        subplot(4,1,4)
        plot(perf(:,2:end));




        <span class="comment">% plot turn of the month performance one by one</span>
            figure;
            x = 1;
            <span class="keyword">while</span> x&lt;= size(eval(list{1}),1)

                subplot(5,3,x)
                plot(perf_start_of_month(:,x+1))
                hold <span class="string">on</span>
                plot(perf_end_of_month(:,x+1))
                plot(perf_turn_of_month(:,x+1))
                plot(perf(:,x+1))
                hold <span class="string">off</span>
                title(Index(x))
                x = x+1;

            <span class="keyword">end</span>




    <span class="comment">% combine month effect and turnofmonth effect</span>
    rt_combined = rt_mx;
    rt_combined(condition_winter | condition_busday &amp; condition_end_of_month &amp; condition_start_of_month,2:end)=0;
    rt_equal_weight = mean(rt_combined(:,2:end)')';

    perf_combined =rt_mx;
    perf_combined(:,2:end) = cumsum(rt_combined(:,2:end));

    perf_equal_weight = rt_mx(:,1:2);
    perf_equal_weight(:,2) = cumsum(rt_equal_weight);

    <span class="comment">% plot combined result all in one.</span>

        figure
        subplot(2,1,1);
        t = datetime(perf_combined(:,1),<span class="string">'ConvertFrom'</span>,<span class="string">'datenum'</span>);
        plot(t,perf_combined(:,2:end));


        subplot(2,1,2);
        t = datetime(perf_combined(:,1),<span class="string">'ConvertFrom'</span>,<span class="string">'datenum'</span>);
        plot(t,perf_equal_weight(:,2));


    <span class="comment">% plot all result, one by one.</span>
        x = 1;
        <span class="keyword">while</span> x&lt;= size(eval(list{k}),1)

            subplot(5,3,x)
            plot(perf_month_effect_winter(:,x+1))
            hold <span class="string">on</span>
            plot(perf_month_effect_summer(:,x+1))
            plot(perf_turn_of_month(:,x+1))
            plot(perf_combined(:,x+1))
            plot(perf(:,x+1))
            hold <span class="string">off</span>
            title(Index(x))
            x = x+1;

        <span class="keyword">end</span>

    <span class="comment">% plot equal weighted portfolio one by one</span>

    rt_winter_eq = mean(rt_month_effect_winter(:,2:end)')';
    perf_winter_eq = rt_mx(:,1:2);
    perf_winter_eq(:,2) = cumsum(rt_winter_eq);

    rt_summer_eq = mean(rt_month_effect_summer(:,2:end)')';
    perf_summer_eq = rt_mx(:,1:2);
    perf_summer_eq(:,2) = cumsum(rt_summer_eq);

    rt_tom_eq = mean(rt_turn_of_month(:,2:end)')';
    perf_tom_eq = rt_mx(:,1:2);
    perf_tom_eq(:,2) = cumsum(rt_tom_eq);

    rt_comb_eq = mean(rt_combined(:,2:end)')';
    perf_comb_eq = rt_mx(:,1:2);
    perf_comb_eq(:,2) = cumsum(rt_comb_eq);

    rt_eq = mean(rt_mx(:,2:end)')';
    perf_eq = rt_mx(:,1:2);
    perf_eq(:,2) = cumsum(rt_eq);

    figure;
    plot(perf_eq(:,2));
    hold <span class="string">on</span>;
    plot(perf_winter_eq(:,2));
    plot(perf_summer_eq(:,2));
    plot(perf_tom_eq(:,2));
    plot(perf_comb_eq(:,2));
    hold <span class="string">off</span>;



    <span class="comment">% calculate sharpe ratio</span>

    riskless = 0;

    sharpe_winter = sqrt(356)*sharpe((rt_month_effect_winter(:,2:end)),riskless);
    sharpe_summer = sqrt(356)*sharpe((rt_month_effect_summer(:,2:end)),riskless);
    sharpe_turn_of_month = sqrt(356)*sharpe((rt_turn_of_month(:,2:end)),riskless);
    sharpe_combined = sqrt(356)*sharpe((rt_combined(:,2:end)),riskless);
    sharpe_all = sqrt(356)*sharpe((rt_mx(:,2:end)),riskless);

    sharpe_eq = sqrt(356)*sharpe(rt_eq,riskless);
    sharpe_winter_eq = sqrt(356)*sharpe(rt_winter_eq,riskless);
    sharpe_summer_eq = sqrt(356)*sharpe(rt_summer_eq,riskless);
    sharpe_tom_eq = sqrt(356)*sharpe(rt_tom_eq,riskless);
    sharpe_comb_eq = sqrt(356)*sharpe(rt_comb_eq,riskless);




    figure
    plot(sharpe_all);
    hold <span class="string">on</span>
    plot(sharpe_winter);
    plot(sharpe_summer);
    plot(sharpe_turn_of_month);
    plot(sharpe_combined)
    hold <span class="string">off</span>

    figure
    plot(sharpe_winter - sharpe_all);
    hold <span class="string">on</span>
    plot(sharpe_summer - sharpe_all);
    plot(sharpe_turn_of_month - sharpe_all);
    plot(sharpe_combined - sharpe_all);
    hold <span class="string">off</span>



<span class="comment">% for demonstration in booklet</span>

    rt_combined = rt_mx;
    rt_combined(condition_winter | condition_busday &amp; condition_end_of_month &amp; condition_start_of_month,2:end)=0;

    rt_equal_weight = mean(rt_combined(:,2:end)')';
    rt_equal_world = mean(rt_mx(:,2:end)')';
    rt_equal_weight_lev = 2.6806*rt_equal_weight;


    perf_equal_weight = rt_mx(:,1:2);
    perf_equal_weight(:,2) = cumsum(rt_equal_weight);
    perf_cal_1 = 1000*exp(cumsum(rt_equal_weight));

    perf_equal_world = rt_mx(:,1:2);
    perf_equal_world(:,2) = cumsum(rt_equal_world);
    perf_index = 1000*exp(cumsum(rt_equal_world));

    perf_equal_weight_lv = rt_mx(:,1:2);
    perf_equal_weight_lv(:,2) = cumsum(rt_equal_weight_lev);
    perf_cal_2 = 1000*exp(cumsum(rt_equal_weight_lev));

    365*mean(rt_equal_world)
    365*mean(rt_equal_weight)
    365*mean(rt_equal_weight_lev)

    sqrt(365)*std(rt_equal_world)
    sqrt(365)*std(rt_equal_weight)
    sqrt(365)*std(rt_equal_weight_lev)

    maxdrawdown(perf_index)
    maxdrawdown(perf_cal_1)
    maxdrawdown(perf_cal_2)


    <span class="comment">% convert to monthly</span>
    dtd = rt_mx(:,1);
    perf_index_ts = fints(dtd, perf_index);
    perf_index_ts = tomonthly(perf_index_ts);
    perf_index = fts2mat(perf_index_ts);
    dt = perf_index_ts.dates;

    perf_cal_1_ts = fints(dtd, perf_cal_1);
    perf_cal_1_ts = tomonthly(perf_cal_1_ts);
    perf_cal_1 = fts2mat(perf_cal_1_ts);

    perf_cal_2_ts = fints(dtd, perf_cal_2);
    perf_cal_2_ts = tomonthly(perf_cal_2_ts);
    perf_cal_2 = fts2mat(perf_cal_2_ts);

    semilogy(dt,perf_index);
    hold <span class="string">on</span>
    semilogy(dt,perf_cal_1);
    semilogy(dt,perf_cal_2);


    datetick(<span class="string">'x'</span>,<span class="string">'yyyy'</span>);

    xlim <span class="string">auto</span>;
    ylim([500 100000]);

    set(gca,<span class="string">'YTick'</span>,[500 1000 2500 5000 10000 25000 50000 100000],<span class="string">'YTickLabel'</span>,{<span class="string">'500'</span>,<span class="string">'1,000'</span>,<span class="string">'2,500'</span>, <span class="string">'5,000'</span>, <span class="string">'10,000'</span>,<span class="string">'25,000'</span>,<span class="string">'50,000'</span>,<span class="string">'100,000'</span>});

    text(dt(end), perf_index(end),[<span class="string">'  Index'</span>],<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>);
    text(dt(end), perf_cal_1(end),[<span class="string">'  Calendar'</span>],<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>);
    text(dt(end), perf_cal_2(end),[<span class="string">'  Leveraged'</span>],<span class="string">'HorizontalAlignment'</span>,<span class="string">'Left'</span>);

    ylabel(<span class="string">'Portfolio Value'</span>, <span class="string">'FontSize'</span>, 18);
    xlabel(<span class="string">'Year'</span>, <span class="string">'FontSize'</span>, 18);


    set(gca,<span class="string">'units'</span>,<span class="string">'centimeters'</span>)
    pos = get(gca,<span class="string">'Position'</span>);
    ti = get(gca,<span class="string">'TightInset'</span>);

    set(gcf, <span class="string">'PaperUnits'</span>,<span class="string">'centimeters'</span>);
    set(gcf, <span class="string">'PaperSize'</span>, [pos(3)+ti(1)*2+ti(3) pos(4)+ti(2)*2+ti(4)]);
    set(gcf, <span class="string">'PaperPositionMode'</span>, <span class="string">'manual'</span>);
    set(gcf, <span class="string">'PaperPosition'</span>,[0 0 pos(3)+ti(1)*2+ti(3) pos(4)+ti(2)*2+ti(4)]);


    <span class="comment">% cumulated variance</span>
    <span class="comment">% k indicates list category.</span>
    <span class="comment">% 1 'Index'</span>
    <span class="comment">% 2 'country'</span>
    <span class="comment">% 3 'fx'</span>
    <span class="comment">% 4 'gsci'</span>
    <span class="comment">% 5 'gsfactors'</span>
    <span class="comment">% 6 'ussectors'</span>

    k = 1;

    rt = tick2ret(px{k},<span class="string">'Method'</span>,<span class="string">'Continuous'</span>);

    rt = fillts(rt,0);

    rt_mx = fts2mat(rt,1);

    perf = rt_mx;
    perf(:,2:end) = cumsum(rt_mx(:,2:end));

    cumvar = cumsum((100*rt_mx(:,2:end)).^2);
    dt = rt_mx(:,1);

    figure
    plot(dt,cumvar)
    datetick(<span class="string">'x'</span>,<span class="string">'yyyy'</span>);
    lgd = eval(list{k});
    lgd
    clickableLegend(lgd(:,1));
    ylabel(<span class="string">'Accumulated Variance'</span>, <span class="string">'FontSize'</span>, 18);

    <span class="comment">% probe for seasonality</span>
    k = 1;

    <span class="comment">% by month</span>


    riskless = 0;
    rt = tick2ret(px{k},<span class="string">'Method'</span>,<span class="string">'Continuous'</span>);
    rt = fillts(rt,0);
    rt_mx = fts2mat(rt,1);

    m = 1;
    <span class="keyword">while</span> m&lt;=12

        rt_month_effect = rt_mx;
        condition_month = not(eq(month(rt_month_effect(:,1)),m));
        rt_month_effect(condition_month,2:end)=0;
        perf_month_effect = rt_month_effect;
        perf_month_effect(:,2:end) = cumsum(rt_month_effect(:,2:end));


        sharpe_month(m,:) = sqrt(356)*sharpe((rt_month_effect(:,2:end)),riskless);


        subplot(4,3,m)
        plot(perf_month_effect(:,2:end));
        title(sprintf(<span class="string">'%i'</span>,m));
        m = m+1;
    <span class="keyword">end</span>

    plot(sharpe_month);

    <span class="comment">% by business day</span>
    <span class="comment">% first few days</span>
    d = 1;
    <span class="keyword">while</span> d&lt;=29

        condition_busday = isbusday(rt_mx(:,1));
        condition_d = not(eq(wrkdydif(fbusdate(year(rt_mx(:,1)),month(rt_mx(:,1))),rt_mx(:,1)),d));

        rt_d = rt_mx;
        rt_d(condition_busday &amp;  condition_d ,2:end) = 0;
        perf_d = rt_d;
        perf_d = cumsum(rt_d(:,2:end));

        rt_d_eq = mean(rt_d(:,2:end)')';
        perf_d_eq = rt_d(:,1:2);
        perf_d_eq(:,2) = cumsum(rt_d_eq);

        subplot(5,6,d)
        plot(perf_d);
        ylim([-1,1.5])

<span class="comment">%       subplot(2,1,2)</span>
<span class="comment">%       plot(perf_d_eq(:,2));</span>

        sharpe_d(d) = sqrt(356)*sharpe(rt_d_eq,riskless);


        d = d+1;

    <span class="keyword">end</span>

    figure
    plot(sharpe_d);

    <span class="comment">% first few days, by index</span>
    i = 1;
    <span class="keyword">while</span> i&lt;=14
        d = 1;
        <span class="keyword">while</span> d&lt;=29

            condition_busday = isbusday(rt_mx(:,1));
            condition_d = not(eq(wrkdydif(fbusdate(year(rt_mx(:,1)),month(rt_mx(:,1))),rt_mx(:,1)),d));
            <span class="comment">% alternative condition_d, counting for the last few days.</span>
            <span class="comment">% condition_d = not(eq(wrkdydif(rt_mx(:,1),fbusdate(year(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)),month(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)))),d));</span>

            rt_d = rt_mx;
            rt_d(condition_busday &amp;  condition_d ,2+i-1) = 0;


            sharpe_d(i,d) = sqrt(356)*sharpe(rt_d(:,2+i-1),riskless);

            d = d+1;

        <span class="keyword">end</span>

        i = i+1;
    <span class="keyword">end</span>

    figure
    plot(sharpe_d');

    <span class="comment">% last few days</span>
    d = 1;
    <span class="keyword">while</span> d &lt;= 29

        rt_d = rt_mx;
        condition_busday = isbusday(rt_mx(:,1));
        condition_d = not(eq(wrkdydif(rt_mx(:,1),fbusdate(year(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)),month(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)))),d));
        rt_d(condition_busday &amp;  condition_d ,2:end) = 0;

        perf_d = rt_d;
        perf_d = cumsum(rt_d(:,2:end));


        rt_d_eq = mean(rt_d(:,2:end)')';
        perf_d_eq = rt_d(:,1:2);
        perf_d_eq(:,2) = cumsum(rt_d_eq);


        subplot(6,5,d)
        plot(perf_d);
        ylim([-1,1.5])
        sharpe_d(d) = sqrt(356)*sharpe(rt_d_eq,riskless);

        d = d+1;

    <span class="keyword">end</span>
</pre><pre class="codeoutput">
ans =

    0.0641


ans =

    0.0511


ans =

    0.1369


ans =

    0.1382


ans =

    0.0516


ans =

    0.1384


ans =

    0.6190


ans =

    0.1302


ans =

    0.3119


lgd = 

    'SPX Index'
    'SHCOMP Index'
    'CCMP Index'
    'MEXBOL Index'
    'SX5E Index'
    'UKX Index'
    'DAX Index'
    'CAC Index'
    'NKY Index'
    'HSI Index'
    'SHSZ300 Index'
    'KOSPI Index'
    'FSSTI Index'
    'SENSEX Index'

</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014b</a><br></p></div><!--
##### SOURCE BEGIN #####

%% This program explore the calendar anormaly using benchmark data downloaded from bloomberg, 
% We use the following seven data sets:
% 'Index','country','fx','gsci','gsfactors','ussectors'
clear;
load benchmarks;
load job_benchmark;


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% transform into fts objects %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

list = {'Index','country','fx','gsci','gsfactors','ussectors'}; 

k=1; 

px = cell(length(list),1); 

period = 10000; 
garch_calib_period = min(2000,period);


while k <= length(list)
    
    n=1; 
    
    px_x = cell(size(eval(list{k}),1),1);

    while n<= size(eval(list{k}),1)
        
        px_x(n) = {fints(storage{k}{n}(end-period:end,1),storage{k}{n}(end-period:end,2),regexprep(eval(sprintf('%s(n,1)',list{k})),'[^a-zA-Z_]',''),'d','LAST_PRICE')};

        n=n+1; 
    
    end
    
    px(k) = {merge(px_x{1:end},'SortColumns',0)};
    
    k = k +1;
    
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%% plot the result  %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% k is list category: Index, fx etc...
% 1 'Index'    
% 2 'country'    
% 3 'fx'    
% 4 'gsci'    
% 5 'gsfactors'    
% 6 'ussectors'

% SELECT k value before proceed. 

k=1;


    
    rt = tick2ret(px{k},'Method','Continuous');
    rt = fillts(rt,0);
    rt_mx = fts2mat(rt,1);
    
    perf = rt_mx; 
    perf(:,2:end) = cumsum(rt_mx(:,2:end)); 
    
    

    % date filter 
    % 0) april - oct effect
    
    rt_month_effect_summer = rt_mx; 
    
    condition_summer = month(rt_month_effect_summer(:,1))>=11 | month(rt_month_effect_summer(:,1))<=4;
    rt_month_effect_summer(condition_summer,2:end)=0;

    rt_month_effect_winter = rt_mx; 
    condition_winter = month(rt_month_effect_winter(:,1))<11 & month(rt_month_effect_winter(:,1))>4;
    rt_month_effect_winter(condition_winter,2:end)=0;

    perf_month_effect_summer = rt_month_effect_summer;
    perf_month_effect_summer(:,2:end) = cumsum(rt_month_effect_summer(:,2:end));
    
    perf_month_effect_winter = rt_month_effect_winter;
    perf_month_effect_winter(:,2:end) = cumsum(rt_month_effect_winter(:,2:end));
    
    
    %% plot summer winter all in one  
        figure;
        subplot(3,1,1)
        plot(perf_month_effect_summer(:,2:end));
        subplot(3,1,2)
        plot(perf_month_effect_winter(:,2:end));
        subplot(3,1,3)
        plot(perf(:,2:end));

    
    %% plot single index one by one
        figure; 
        i = 1;
        while i<= size(eval(list{k}),1)

            subplot(5,3,i)
            plot(perf_month_effect_summer(:,i+1))
            hold on
            plot(perf_month_effect_winter(:,i+1))
            plot(perf(:,i+1))
            hold off
            title(Index(i))
            i = i+1; 

        end 

    

    
    % 1) first three and last three working date of month
    
    rt_start_of_month = rt_mx; 
    condition_busday = isbusday(rt_mx(:,1));
    condition_start_of_month = wrkdydif(fbusdate(year(rt_mx(:,1)),month(rt_mx(:,1))),rt_mx(:,1))>3;
    
    rt_start_of_month(condition_busday &  condition_start_of_month ,2:end) = 0;
    
    rt_end_of_month = rt_mx; 
    condition_end_of_month = wrkdydif(rt_mx(:,1),fbusdate(year(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)),month(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1))))>4;
    rt_end_of_month(condition_busday &  condition_end_of_month ,2:end) = 0;

    rt_turn_of_month = rt_mx;
    rt_turn_of_month(condition_busday & (condition_end_of_month & condition_start_of_month),2:end)= 0;
    
    perf_start_of_month =rt_mx;
    perf_start_of_month(:,2:end) = cumsum(rt_start_of_month(:,2:end));
    
    perf_end_of_month =rt_mx;
    perf_end_of_month(:,2:end) = cumsum(rt_end_of_month(:,2:end));
    
    perf_turn_of_month = rt_mx;
    perf_turn_of_month(:,2:end) = cumsum(rt_turn_of_month(:,2:end));
    
    
    
    % plot turn of month performance all in one
        figure;
        subplot(4,1,1)
        plot(perf_start_of_month(:,2:end));
        subplot(4,1,2)
        plot(perf_end_of_month(:,2:end));
        subplot(4,1,3)
        plot(perf_turn_of_month(:,2:end));
        subplot(4,1,4)
        plot(perf(:,2:end));
    
        
    
    
        % plot turn of the month performance one by one
            figure;
            x = 1;
            while x<= size(eval(list{1}),1)

                subplot(5,3,x)
                plot(perf_start_of_month(:,x+1))
                hold on
                plot(perf_end_of_month(:,x+1))
                plot(perf_turn_of_month(:,x+1))
                plot(perf(:,x+1))
                hold off
                title(Index(x))
                x = x+1; 

            end 

   
    
    
    % combine month effect and turnofmonth effect
    rt_combined = rt_mx; 
    rt_combined(condition_winter | condition_busday & condition_end_of_month & condition_start_of_month,2:end)=0;
    rt_equal_weight = mean(rt_combined(:,2:end)')';
    
    perf_combined =rt_mx;
    perf_combined(:,2:end) = cumsum(rt_combined(:,2:end));
    
    perf_equal_weight = rt_mx(:,1:2);
    perf_equal_weight(:,2) = cumsum(rt_equal_weight);
    
    % plot combined result all in one. 

        figure
        subplot(2,1,1);
        t = datetime(perf_combined(:,1),'ConvertFrom','datenum');
        plot(t,perf_combined(:,2:end));


        subplot(2,1,2);
        t = datetime(perf_combined(:,1),'ConvertFrom','datenum');
        plot(t,perf_equal_weight(:,2));


    % plot all result, one by one. 
        x = 1;
        while x<= size(eval(list{k}),1)

            subplot(5,3,x)
            plot(perf_month_effect_winter(:,x+1))
            hold on
            plot(perf_month_effect_summer(:,x+1))
            plot(perf_turn_of_month(:,x+1))
            plot(perf_combined(:,x+1))
            plot(perf(:,x+1))
            hold off
            title(Index(x))
            x = x+1; 

        end 

    % plot equal weighted portfolio one by one
    
    rt_winter_eq = mean(rt_month_effect_winter(:,2:end)')'; 
    perf_winter_eq = rt_mx(:,1:2);
    perf_winter_eq(:,2) = cumsum(rt_winter_eq);
    
    rt_summer_eq = mean(rt_month_effect_summer(:,2:end)')'; 
    perf_summer_eq = rt_mx(:,1:2);
    perf_summer_eq(:,2) = cumsum(rt_summer_eq);
    
    rt_tom_eq = mean(rt_turn_of_month(:,2:end)')'; 
    perf_tom_eq = rt_mx(:,1:2);
    perf_tom_eq(:,2) = cumsum(rt_tom_eq);
    
    rt_comb_eq = mean(rt_combined(:,2:end)')'; 
    perf_comb_eq = rt_mx(:,1:2);
    perf_comb_eq(:,2) = cumsum(rt_comb_eq);
    
    rt_eq = mean(rt_mx(:,2:end)')'; 
    perf_eq = rt_mx(:,1:2);
    perf_eq(:,2) = cumsum(rt_eq);
    
    figure; 
    plot(perf_eq(:,2)); 
    hold on; 
    plot(perf_winter_eq(:,2)); 
    plot(perf_summer_eq(:,2)); 
    plot(perf_tom_eq(:,2)); 
    plot(perf_comb_eq(:,2)); 
    hold off; 
    
    
    
    % calculate sharpe ratio

    riskless = 0; 
    
    sharpe_winter = sqrt(356)*sharpe((rt_month_effect_winter(:,2:end)),riskless);
    sharpe_summer = sqrt(356)*sharpe((rt_month_effect_summer(:,2:end)),riskless);
    sharpe_turn_of_month = sqrt(356)*sharpe((rt_turn_of_month(:,2:end)),riskless);
    sharpe_combined = sqrt(356)*sharpe((rt_combined(:,2:end)),riskless);
    sharpe_all = sqrt(356)*sharpe((rt_mx(:,2:end)),riskless);

    sharpe_eq = sqrt(356)*sharpe(rt_eq,riskless);
    sharpe_winter_eq = sqrt(356)*sharpe(rt_winter_eq,riskless);
    sharpe_summer_eq = sqrt(356)*sharpe(rt_summer_eq,riskless);
    sharpe_tom_eq = sqrt(356)*sharpe(rt_tom_eq,riskless);
    sharpe_comb_eq = sqrt(356)*sharpe(rt_comb_eq,riskless);
    
    
    
    
    figure
    plot(sharpe_all); 
    hold on
    plot(sharpe_winter); 
    plot(sharpe_summer); 
    plot(sharpe_turn_of_month); 
    plot(sharpe_combined)
    hold off
    
    figure 
    plot(sharpe_winter - sharpe_all); 
    hold on 
    plot(sharpe_summer - sharpe_all); 
    plot(sharpe_turn_of_month - sharpe_all); 
    plot(sharpe_combined - sharpe_all); 
    hold off
    


% for demonstration in booklet 

    rt_combined = rt_mx; 
    rt_combined(condition_winter | condition_busday & condition_end_of_month & condition_start_of_month,2:end)=0;
    
    rt_equal_weight = mean(rt_combined(:,2:end)')';
    rt_equal_world = mean(rt_mx(:,2:end)')'; 
    rt_equal_weight_lev = 2.6806*rt_equal_weight; 
    
    
    perf_equal_weight = rt_mx(:,1:2);
    perf_equal_weight(:,2) = cumsum(rt_equal_weight);
    perf_cal_1 = 1000*exp(cumsum(rt_equal_weight)); 
    
    perf_equal_world = rt_mx(:,1:2);
    perf_equal_world(:,2) = cumsum(rt_equal_world);
    perf_index = 1000*exp(cumsum(rt_equal_world));
    
    perf_equal_weight_lv = rt_mx(:,1:2);
    perf_equal_weight_lv(:,2) = cumsum(rt_equal_weight_lev);
    perf_cal_2 = 1000*exp(cumsum(rt_equal_weight_lev)); 
    
    365*mean(rt_equal_world)
    365*mean(rt_equal_weight)
    365*mean(rt_equal_weight_lev)
    
    sqrt(365)*std(rt_equal_world)
    sqrt(365)*std(rt_equal_weight)
    sqrt(365)*std(rt_equal_weight_lev)
    
    maxdrawdown(perf_index)
    maxdrawdown(perf_cal_1)
    maxdrawdown(perf_cal_2)
    
    
    % convert to monthly 
    dtd = rt_mx(:,1); 
    perf_index_ts = fints(dtd, perf_index); 
    perf_index_ts = tomonthly(perf_index_ts); 
    perf_index = fts2mat(perf_index_ts);
    dt = perf_index_ts.dates; 
    
    perf_cal_1_ts = fints(dtd, perf_cal_1); 
    perf_cal_1_ts = tomonthly(perf_cal_1_ts); 
    perf_cal_1 = fts2mat(perf_cal_1_ts);
    
    perf_cal_2_ts = fints(dtd, perf_cal_2); 
    perf_cal_2_ts = tomonthly(perf_cal_2_ts); 
    perf_cal_2 = fts2mat(perf_cal_2_ts);
    
    semilogy(dt,perf_index); 
    hold on
    semilogy(dt,perf_cal_1); 
    semilogy(dt,perf_cal_2); 
    
    
    datetick('x','yyyy');
    
    xlim auto; 
    ylim([500 100000]); 
    
    set(gca,'YTick',[500 1000 2500 5000 10000 25000 50000 100000],'YTickLabel',{'500','1,000','2,500', '5,000', '10,000','25,000','50,000','100,000'});

    text(dt(end), perf_index(end),['  Index'],'HorizontalAlignment','Left');
    text(dt(end), perf_cal_1(end),['  Calendar'],'HorizontalAlignment','Left');
    text(dt(end), perf_cal_2(end),['  Leveraged'],'HorizontalAlignment','Left');

    ylabel('Portfolio Value', 'FontSize', 18);
    xlabel('Year', 'FontSize', 18);
    
    
    set(gca,'units','centimeters')
    pos = get(gca,'Position');
    ti = get(gca,'TightInset');

    set(gcf, 'PaperUnits','centimeters');
    set(gcf, 'PaperSize', [pos(3)+ti(1)*2+ti(3) pos(4)+ti(2)*2+ti(4)]);
    set(gcf, 'PaperPositionMode', 'manual');
    set(gcf, 'PaperPosition',[0 0 pos(3)+ti(1)*2+ti(3) pos(4)+ti(2)*2+ti(4)]);

    
    % cumulated variance 
    % k indicates list category. 
    % 1 'Index'    
    % 2 'country'    
    % 3 'fx'    
    % 4 'gsci'    
    % 5 'gsfactors'    
    % 6 'ussectors'
    
    k = 1; 
    
    rt = tick2ret(px{k},'Method','Continuous');

    rt = fillts(rt,0);
    
    rt_mx = fts2mat(rt,1);
    
    perf = rt_mx; 
    perf(:,2:end) = cumsum(rt_mx(:,2:end)); 
    
    cumvar = cumsum((100*rt_mx(:,2:end)).^2); 
    dt = rt_mx(:,1); 
    
    figure
    plot(dt,cumvar)
    datetick('x','yyyy'); 
    lgd = eval(list{k}); 
    lgd
    clickableLegend(lgd(:,1));
    ylabel('Accumulated Variance', 'FontSize', 18);
    
    % probe for seasonality
    k = 1; 
    
    % by month
    
    
    riskless = 0; 
    rt = tick2ret(px{k},'Method','Continuous');
    rt = fillts(rt,0);
    rt_mx = fts2mat(rt,1);
    
    m = 1;
    while m<=12
        
        rt_month_effect = rt_mx;
        condition_month = not(eq(month(rt_month_effect(:,1)),m));
        rt_month_effect(condition_month,2:end)=0;
        perf_month_effect = rt_month_effect;
        perf_month_effect(:,2:end) = cumsum(rt_month_effect(:,2:end));
        
    
        sharpe_month(m,:) = sqrt(356)*sharpe((rt_month_effect(:,2:end)),riskless);

        
        subplot(4,3,m)
        plot(perf_month_effect(:,2:end)); 
        title(sprintf('%i',m));
        m = m+1; 
    end 
    
    plot(sharpe_month);
    
    % by business day 
    % first few days 
    d = 1; 
    while d<=29
        
        condition_busday = isbusday(rt_mx(:,1));
        condition_d = not(eq(wrkdydif(fbusdate(year(rt_mx(:,1)),month(rt_mx(:,1))),rt_mx(:,1)),d));

        rt_d = rt_mx; 
        rt_d(condition_busday &  condition_d ,2:end) = 0;
        perf_d = rt_d; 
        perf_d = cumsum(rt_d(:,2:end)); 
        
        rt_d_eq = mean(rt_d(:,2:end)')'; 
        perf_d_eq = rt_d(:,1:2); 
        perf_d_eq(:,2) = cumsum(rt_d_eq); 
        
        subplot(5,6,d)
        plot(perf_d); 
        ylim([-1,1.5])
        
%       subplot(2,1,2)
%       plot(perf_d_eq(:,2)); 
        
        sharpe_d(d) = sqrt(356)*sharpe(rt_d_eq,riskless);
        

        d = d+1; 
    
    end 
    
    figure
    plot(sharpe_d); 
    
    % first few days, by index 
    i = 1; 
    while i<=14
        d = 1; 
        while d<=29

            condition_busday = isbusday(rt_mx(:,1));
            condition_d = not(eq(wrkdydif(fbusdate(year(rt_mx(:,1)),month(rt_mx(:,1))),rt_mx(:,1)),d));
            % alternative condition_d, counting for the last few days. 
            % condition_d = not(eq(wrkdydif(rt_mx(:,1),fbusdate(year(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)),month(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)))),d));

            rt_d = rt_mx; 
            rt_d(condition_busday &  condition_d ,2+i-1) = 0;


            sharpe_d(i,d) = sqrt(356)*sharpe(rt_d(:,2+i-1),riskless);

            d = d+1; 

        end     
        
        i = i+1; 
    end 
    
    figure
    plot(sharpe_d'); 
    
    % last few days 
    d = 1; 
    while d <= 29
        
        rt_d = rt_mx; 
        condition_busday = isbusday(rt_mx(:,1));
        condition_d = not(eq(wrkdydif(rt_mx(:,1),fbusdate(year(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)),month(datetime(year(rt_mx(:,1)),month(rt_mx(:,1)),day(rt_mx(:,1)))+calmonths(1)))),d));
        rt_d(condition_busday &  condition_d ,2:end) = 0;
        
        perf_d = rt_d; 
        perf_d = cumsum(rt_d(:,2:end)); 
        
        
        rt_d_eq = mean(rt_d(:,2:end)')'; 
        perf_d_eq = rt_d(:,1:2); 
        perf_d_eq(:,2) = cumsum(rt_d_eq); 
        

        subplot(6,5,d)
        plot(perf_d); 
        ylim([-1,1.5])
        sharpe_d(d) = sqrt(356)*sharpe(rt_d_eq,riskless);
        
        d = d+1; 
        
    end 
    
    

##### SOURCE END #####
--></body></html>